<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="format-detection" content="telephone=no">
<title>自転車ゲーム | 彩りの輪 ～Saitama Cycle Journey～</title>
<meta name="description" content="自転車発祥の地・埼玉県の歴史と魅力を巡る旅へ。300年前に考案された陸船車や、自転車王国・埼玉の最新スポット、博物館イベント情報など、サイクリスト初心者からベテランまで楽しめる情報満載！">
<link rel="icon" href="./img/favicon.ico">

<!-- CSS Area -->
<link href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="stylesheet" href="./css/normalize.css">
<link rel="stylesheet" href="./css/common.css">
<link rel="stylesheet" href="./css/style.css">
<link rel="stylesheet" href="./css/add.css">
<link rel="stylesheet" href="./css/page.css">
<!-- /CSS Area -->

<!-- JS Area -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="./js/templates.include.js"></script>
<!-- /JS Area -->
</head>


<body id="Page">
<div class="bg" style="display: none;"></div>


<div id="header"></div>
<nav id="breadcrumb"></nav>


<main>
<!-- // intro // -->
  <div class="intro inview fadeIn_up">
    <h2><b id="txt_radius 1">埼玉名産アイテムをキャッチ</b>自転車ゲーム<span>Catch & Ride: Saitama’s Local Loot</span></h2>
    <figure><img src="./img/***.jpg" alt="＊＊＊＊＊" class="trim ph"></figure>
    <p class="read_txt">
    落ちてくる“埼玉の特産アイテム”を拾いながら、サイクリングでスコアを競うゲーム！<br><span class="u_line">反射神経も学びもフル活用、遊びながら地元の魅力を再発見。</span><br>大人も子どもも夢中になる、疾走アクション体験！
    </p>
  </div>
<!-- // intro // -->


  <div class="mainCnt">
    <section id="Sec01" class="sec-scroll-point">
      <article class="inview fadeIn_up">
        <h3><span>＊＊＊＊＊</span><b>＊＊＊＊＊</b></h3>
        <figure><img src="#" alt="＊＊＊＊＊" class="ph"></figure>
        <div class="content-block">
          <p class="leadTxt clearfix">
            ＊＊＊＊＊
          </p>
        </div>

        <div class="content-block">
          <dl class="talk">
            <dt class="inview_re delay_a">
              <div class="faceicon icon-a"></div>
              <b>＊＊＊＊＊</b>
            </dt>
            <dd class="inview_re delay_b">
              <div class="faceicon icon-b"></div>
              <p>
                ＊＊＊＊＊
              </p>
            </dd>
          </dl>
        </div>

<style>
canvas {
  background: #eef;
  display: block;
  margin: 30px auto;
  border: 2px solid #333;
  width: 100%;
  height: auto;
  max-width: 400px;
  aspect-ratio: 2 / 3;
}
#startButton,
#restartButton {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  padding: 12px 24px;
  font-size: 18px;
  z-index: 10;
  background-color: #fff;
  border: 2px solid #333;
  border-radius: 8px;
  cursor: pointer;
  white-space: nowrap;
  max-width: none;
  text-align: center;
}
#restartButton {
  top: 60%;
}
@media (max-width: 480px) {
  canvas {
    max-width: 100vw;
    max-height: 100vh;
    aspect-ratio: 2 / 3;
  }
}
</style>
        <div id="Game" class="content-block">
<!-- ゲーム本体 -->
<div style="position: relative; width: 100%; max-width: 400px; margin: auto;">
  <canvas id="gameCanvas"></canvas>
  <button id="startButton">ゲームスタート</button>
  <button id="restartButton" style="display:none;">もう一度プレイする</button>
</div>
        </div>
      </article>
    </section>


<!-- // snsArea // -->
    <div class="snsArea sec-scroll-point">
      <div class="inview fadeIn_up">
        <b>SHARE</b>
        <ul class="flexBox">
          <li><a href="https://www.facebook.com/share.php?u={URL}" rel="nofollow noopener" target="_blank"><i class="fab fa-facebook-square"></i></a></li>
          <li><a href="http://twitter.com/share?url=[URL]" rel="nofollow noopener" target="_blank"><img src="./img/logo-white.png" class="x_icon"></a></li>
          <li><a href="https://line.me/R/msg/text/?{URL}" target="_blank" rel="nofollow noopener"><i class="fab fa-line"></i></a></li>
        </ul>
      </div>
    </div>
<!-- // snsArea // -->

  </div>
</main>


<div id="footer"></div>
<div id="PageTop"><a href="#"><i class="fa fa-chevron-up"></i></a></div>


<!-- JS Area -->
   <script>
let gameStarted = false;
function handleTouch(e) {
  if (!gameStarted) return;

  const touchX = e.touches[0].clientX - canvas.getBoundingClientRect().left;
  let newX = touchX - bike.width / 2;

  // 左端に出ないように
  if (newX < 0) newX = 0;

  // 右端に出ないように
  if (newX + bike.width > canvas.width) {
    newX = canvas.width - bike.width;
  }

  bike.x = newX;
  e.preventDefault();
}

document.getElementById("startButton").addEventListener("click", () => {
  gameStarted = true;
  document.getElementById("startButton").style.display = "none";
  resizeCanvas();
  gameLoop();
});

document.getElementById("restartButton").addEventListener("click", () => {
  score = 0;
  bike.x = 180;
  items = Array.from({ length: 5 }, () => {
    const type = getRandomItemType();
    return {
      x: Math.random() * (canvas.width - 30),
      y: Math.random() * -600,
      type: type
    };
  });
  document.getElementById("restartButton").style.display = "none";
  gameLoop();
});


    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

// アイテムの種類と得点を定義
const itemTypes = {
  apple: { color: "green", score: 10 },
  banana: { color: "yellow", score: 20 },
  bomb: { color: "red", score: -15 },
  star: { color: "gold", score: 50 }
};

function getRandomItemType() {
  const keys = Object.keys(itemTypes);
  return keys[Math.floor(Math.random() * keys.length)];
}


let bike = {
  x: 180,
  y: canvas.height - 60, // 高さに応じて調整（40pxキャラ＋余白20px）
  width: 40,
  height: 40,
  speed: 6
};
    let keys = {};
    let score = 0;

    // 🏁クリア条件（ここでスコアを変更できます）
    let clearScore = 500;

// アイテム配列
let items = Array.from({ length: 5 }, () => {
  const type = getRandomItemType();
  return {
    x: Math.random() * 360,
    y: Math.random() * -600,
    type: type
  };
});

    document.addEventListener("keydown", e => keys[e.key] = true);
    document.addEventListener("keyup", e => keys[e.key] = false);

    function gameLoop() {
      if (!gameStarted) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // 自転車操作
if (keys["ArrowLeft"]) {
  bike.x = Math.max(0, bike.x - bike.speed);
}
if (keys["ArrowRight"]) {
  bike.x = Math.min(canvas.width - bike.width, bike.x + bike.speed);
}

      // アイテム処理
      items.forEach(item => {
        item.y += 3;
ctx.fillStyle = itemTypes[item.type].color;
ctx.fillRect(item.x, item.y, 30, 30);

        // 衝突判定
if (
  bike.x < item.x + 30 &&
  bike.x + bike.width > item.x &&
  bike.y < item.y + 30 &&
  bike.y + bike.height > item.y
) {
  score += itemTypes[item.type].score;
  const newType = getRandomItemType();
  item.y = -40;
  item.x = Math.random() * (canvas.width - 30);
  item.type = newType;
}

if (item.y > canvas.height) {
  const newType = getRandomItemType();
  item.y = -40;
  item.x = Math.random() * (canvas.width - 30);
  item.type = newType;
}
      });

      // 自転車描画
      ctx.fillStyle = "blue";
      ctx.fillRect(bike.x, bike.y, bike.width, bike.height);

      // スコア表示
      ctx.fillStyle = "black";
      ctx.font = "20px sans-serif";
      ctx.fillText("Score: " + score, 10, 30);

      // 🎉クリア判定
if (score >= clearScore) {
  ctx.shadowColor = "gray";
  ctx.shadowBlur = 1;
  ctx.fillStyle = "black";
  ctx.font = "bold 30px sans-serif";

  const message = "🎉congratulations！";
  const textWidth = ctx.measureText(message).width;
  const x = (canvas.width - textWidth) / 2;
  const y = canvas.height / 2;

  ctx.fillText(message, x, y);

  document.getElementById("restartButton").style.display = "block";
  return;
} else {
        requestAnimationFrame(gameLoop);
      }
    }

    gameLoop();


function resizeCanvas() {
  const rect = canvas.getBoundingClientRect();
  canvas.width = rect.width;
  canvas.height = rect.height;

  // キャラ位置を画面サイズに合わせて再設定
  bike.x = (canvas.width - bike.width) / 2;
  bike.y = canvas.height - bike.height - 20;
}

window.addEventListener("resize", resizeCanvas);
resizeCanvas(); // 初期化時にも呼び出す

canvas.addEventListener("touchstart", handleTouch);
canvas.addEventListener("touchmove", handleTouch);

ctx.font = `${canvas.width / 20}px sans-serif`;
  </script>
<!-- /JS Area -->
</body>
</html>